<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="这题超纲了">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    
        
            <link rel="preconnect" href="https://npm.elemecdn.com" crossorigin>
        
    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://example.com/2023/03/07/blog10/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="天生我材必有用,千金散尽还复来!">
<meta property="og:type" content="article">
<meta property="og:title" content="操作系统中的内存管理">
<meta property="og:url" content="http://example.com/2023/03/07/blog10/index.html">
<meta property="og:site_name">
<meta property="og:description" content="天生我材必有用,千金散尽还复来!">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2023/03/07/blog10/%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80.jpg">
<meta property="og:image" content="http://example.com/2023/03/07/blog10/%E6%AE%B5.jpg">
<meta property="og:image" content="http://example.com/2023/03/07/blog10/%E6%AE%B51.jpg">
<meta property="og:image" content="http://example.com/2023/03/07/blog10/%E5%86%85%E5%AD%98%E7%A2%8E%E7%89%87.jpg">
<meta property="og:image" content="http://example.com/2023/03/07/blog10/%E5%88%86%E9%A1%B5.jpg">
<meta property="og:image" content="http://example.com/2023/03/07/blog10/%E5%88%86%E9%A1%B51.jpg">
<meta property="og:image" content="http://example.com/2023/03/07/blog10/%E9%A1%B5%E8%A1%A8.jpg">
<meta property="og:image" content="http://example.com/2023/03/07/blog10/%E4%BA%8C%E7%BA%A7%E9%A1%B5%E8%A1%A8.jpg">
<meta property="og:image" content="http://example.com/2023/03/07/blog10/%E5%9B%9B%E7%BA%A7%E9%A1%B5%E8%A1%A8.jpg">
<meta property="og:image" content="http://example.com/2023/03/07/blog10/TLB.jpg">
<meta property="og:image" content="http://example.com/2023/03/07/blog10/%E6%AE%B5%E9%A1%B5%E5%BC%8F.jpg">
<meta property="og:image" content="http://example.com/2023/03/07/blog10/Intel.jpg">
<meta property="og:image" content="http://example.com/2023/03/07/blog10/swap.jpg">
<meta property="article:published_time" content="2023-03-07T05:39:46.000Z">
<meta property="article:modified_time" content="2023-06-23T06:39:23.323Z">
<meta property="article:tag" content="操作系统">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2023/03/07/blog10/%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80.jpg">
    
    
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id="></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', '');
        </script>
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/%E6%B4%BE1.jpg" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/%E6%B4%BE1.jpg">
    <meta name="theme-color" content="#005080">
    <link rel="shortcut icon" href="/images/%E6%B4%BE1.jpg">
    <!--- Page Info-->
    
    <title>
        
            操作系统中的内存管理 -
        
        这题超纲了的BLOG
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="stylesheet" href="//npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/assets/fonts.css">
    <!--- Font Part-->
    
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    
    
        <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    
    
        <link href="https://fonts.googleapis.com/css2?family=Farsan&display=swap" rel="stylesheet">
    

    <!--- Inject Part-->
    
        
            
    
            
    
    <script id="hexo-configurations">
    let Global = window.Global || {};
    Global.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN","path":"search.xml"};
    Global.theme_config = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":true,"link_icon":true},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":["铜皮","草根","柳筋","骨气","铸庐","洞府境","观海境","龙门境","金丹境","元婴境","玉璞境","仙人境","飞升境","十四境","十五境"]},"code_block":{"copy":true,"style":"mac","font":{"enable":true,"family":null,"url":"https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;500;600;700&display=swap"}},"toc":{"enable":true,"max_depth":5,"number":false,"expand":true,"init_open":true},"copyright":true,"lazyload":true,"recommendation":{"enable":true,"title":"推荐阅读","limit":3,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#005080","secondary":null},"global":{"fonts":{"chinese":{"enable":true,"family":"Noto Sans SC","url":"https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap"},"english":{"enable":true,"family":"Farsan","url":"https://fonts.googleapis.com/css2?family=Farsan&display=swap"}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":false,"scale":true},"scroll_progress":{"bar":true,"percentage":true},"busuanzi_counter":{"enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"pjax":true,"open_graph":true,"google_analytics":{"enable":true,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/水墨/水墨.jpg","dark":"/images/水墨/水墨1.jpg"},"title":"~欢迎来到“派大星”的博客~","subtitle":{"text":["言念君子,温其如玉","我见青山多妩媚,料青山见我应如是","有些人心如花木,皆向阳而生","遇事不决,可问春风。春风不语,即随本心","人生当苦无妨,良人当归即好"],"hitokoto":{"enable":true,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#000000","dark":"#FAFFFE"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":true,"family":"Noto Sans SC","url":"https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap"},"social_links":{"enable":"enable","links":{"github":"https://github.com/Qx-GG","instagram":null,"zhihu":"https://www.zhihu.com/people/bu-shang-530bu-gai-ming","twitter":null,"email":null,"weixin":"/images/微信.jpg","bilibili":"https://space.bilibili.com/38628118?spm_id_from=333.1007.0.0"}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.1.5","navbar":{"auto_hide":false,"color":{"left":"#FAFFFE","right":"#FAFFFE","transparency":35},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Tags":{"path":"/tags","icon":"fa-regular fa-chart-bar"},"Links":{"path":"/links","icon":"fa-regular fa-link"},"About":{"icon":"fa-regular fa-user","submenus":{"Me":"/about","Github":"https://github.com/Qx-GG","Bilibili":"https://space.bilibili.com/38628118?spm_id_from=333.1007.0.0"}},"WorMhole":{"path":"https://foreverblog.cn/go.html","icon":"fa-regular fa-planet-ringed"}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":"言念君子,温其如玉","links":{"PYQ":{"path":"/shuoshuo","icon":"fa-regular fa-messages"},"Photo":{"path":"/masonry","icon":"fa-regular fa-photo-film"}}},"article_date_format":"auto","categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}}};
    Global.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
    Global.data_config = {"masonry":true};
  </script>
    
    <!--- Fontawesome Part-->
    <link rel="stylesheet" href="//npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/fontawesome/fontawesome.min.css">
    <link rel="stylesheet" href="//npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/fontawesome/brands.min.css">
    <link rel="stylesheet" href="//npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/fontawesome/solid.min.css">
    <link rel="stylesheet" href="//npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/fontawesome/regular.min.css">
    
    
    
        <link rel="stylesheet" href="//npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/fontawesome/duotone.min.css">
    
    
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="null" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="main-content-container">

        <div class="main-content-header">
            <header class="navbar-container">
    
    <div class="navbar-content">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="/images/%E6%B4%BE1.jpg">
                </a>
            
            <a class="logo-title" href="/">
                
                这题超纲了的BLOG
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/"  >
                                    
                                        
                                            <i class="fa-regular fa-house"></i>
                                        
                                        首页
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/archives"  >
                                    
                                        
                                            <i class="fa-regular fa-archive"></i>
                                        
                                        归档
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/tags"  >
                                    
                                        
                                            <i class="fa-regular fa-chart-bar"></i>
                                        
                                        标签
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/links"  >
                                    
                                        
                                            <i class="fa-regular fa-link"></i>
                                        
                                        链接
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown" 
                                    href="#" onClick="return false;">
                                    
                                        
                                            <i class="fa-regular fa-user"></i>
                                        
                                        关于&nbsp;<i class="fa-solid fa-chevron-down"></i>
                                    
                                </a>
                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                    
                                        <li>
                                        <a href="/about">ME
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://github.com/Qx-GG">GITHUB
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://space.bilibili.com/38628118?spm_id_from=333.1007.0.0">BILIBILI
                                        </a>
                                        </li>
                                    
                                    </ul>
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    target="_blank" rel="noopener" href="https://foreverblog.cn/go.html"  >
                                    
                                        
                                            <i class="fa-regular fa-planet-ringed"></i>
                                        
                                        WORMHOLE
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="navbar-drawer">
        <ul class="drawer-navbar-list">
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/"  >
                             
                                
                                    <i class="fa-regular fa-house"></i>
                                
                                首页
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/archives"  >
                             
                                
                                    <i class="fa-regular fa-archive"></i>
                                
                                归档
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/tags"  >
                             
                                
                                    <i class="fa-regular fa-chart-bar"></i>
                                
                                标签
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/links"  >
                             
                                
                                    <i class="fa-regular fa-link"></i>
                                
                                链接
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="has-dropdown" 
                        href="#" onClick="return false;">
                            
                                
                                    <i class="fa-regular fa-user"></i>
                                
                                关于&nbsp;<i class="fa-solid fa-chevron-down"></i>
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                              
                        
                            <li class="dropdown-item flex-center">
                                <a class="dropdown-item" href="/about">ME</a>
                            </li>
                        
                            <li class="dropdown-item flex-center">
                                <a class="dropdown-item" target="_blank" rel="noopener" href="https://github.com/Qx-GG">GITHUB</a>
                            </li>
                        
                            <li class="dropdown-item flex-center">
                                <a class="dropdown-item" target="_blank" rel="noopener" href="https://space.bilibili.com/38628118?spm_id_from=333.1007.0.0">BILIBILI</a>
                            </li>
                        
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        target="_blank" rel="noopener" href="https://foreverblog.cn/go.html"  >
                             
                                
                                    <i class="fa-regular fa-planet-ringed"></i>
                                
                                WORMHOLE
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="post-page-container">
        <div class="article-content-container">

            
                      
                <div class="article-title">
                    <img src="https://Qx-GG.github.io/images/水墨/水墨11.jpg" alt="操作系统中的内存管理" />
                    <h1 class="article-title-cover">操作系统中的内存管理</h1>
                </div>
            
                
            

            
                <div class="article-header">
                    <div class="avatar">
                        <img src="/images/%E6%B4%BE%E5%A4%A7%E6%98%9F.png">
                    </div>
                    <div class="info">
                        <div class="author">
                            <span class="name">这题超纲了</span>
                            
                                <span class="author-label">柳筋</span>
                            
                        </div>
                        <div class="meta-info">
                            <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2023-03-07 13:39:46</span>
        <span class="mobile">2023-03-07 13:39</span>
        <span class="hover-info">创建</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2023-06-23 14:39:23</span>
            <span class="mobile">2023-06-23 14:39</span>
            <span class="hover-info">更新</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>6.9k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>23 分钟</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content markdown-body">
                <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=5257205&auto=1&height=66"></iframe>

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这是一篇鼠鼠看完<code>小林coding</code>文章后总结的关于操作系统中的内存管理的一些知识点，并且穿插了几个面试题，我自己是看完了小林的答案才知道的，觉得属于这一块的内容于是就写上去了，gogogo!</p>
<h2 id="内存管理"><a href="#内存管理" class="headerlink" title="内存管理"></a>内存管理</h2><p>我们知道，所有的程序最后都是在<strong>内存</strong>中执行的，准确来说，应该是说所有程序运行的时候，都需要加载到内存中才能被CPU获取从而进行代码的执行</p>
<details class="red" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>单片机 </summary>
              <div class="content">
              <p>鼠鼠是电子信息工程专业的，虽然我对这个专业一点兴趣都没有，但是有些知识鼠鼠还是知道的，比如<strong>单片机</strong><br>单片机是<strong>没有操作系统</strong>的，所以我们想要将单片机上的程序运行起来，就必须通过一些工具将我们写的代码<strong>烧入</strong>单片机的内存中，这样程序才能执行，而且单片机的CPU是<strong>直接操作物理内存的</strong></p><p>那么这样做有什么问题呢?</p><p>因为单片机是直接操作物理地址的，所以就会出现在同一个地址上可能会有两种代码，比如第一个代码烧入单片机后占据了物理内存的某个位置，当我们烧入第二个代码时，万一也是在相同的物理地址上，第一个程序就没办法继续执行了</p>
              </div>
            </details>

<p>在现代的计算机中，操作系统是如何解决上面的问题呢?</p>
<h3 id="虚拟内存"><a href="#虚拟内存" class="headerlink" title="虚拟内存"></a>虚拟内存</h3><ol>
<li>因为如果有一个进程在某一块内存上运行，此时该内存上是无法运行第二个人进程的，就无法做到<strong>并行</strong>地运行多个进程，<strong>为了避免多个程序都引用了绝对物理地址</strong>，于是就引入了<strong>虚拟内存</strong></li>
<li><strong>每个进程分配独立的虚拟地址(32位操作系统会有4G的虚拟地址，其中1G是属于内核空间，3G属于用户空间；64位操作系统就大得多，用户空间和内核空间都是128T)，互不干涉，有个前提就是每个进程都没办法直接访问物理地址</strong>，至于虚拟地址是如何落到物理地址上的，对进程来说是<strong>透明的</strong>，操作系统已经把这些都安排好了</li>
<li><strong>操作系统会提供一种机制，将不同进程的虚拟地址和不同内存的物理地址映射起来</strong><details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>虚拟内存地址 </summary>
              <div class="content">
              <p>程序使用的内存地址</p>
              </div>
            </details>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>物理内存地址 </summary>
              <div class="content">
              <p>实际物理硬件(内存条)里面的空间地址</p>
              </div>
            </details></li>
</ol>
<p>操作系统引入了虚拟内存。进程持有的虚拟地址会通过CPU芯片中的**内存管理单元(MMU)**的映射关系，来转化为物理地址，然后通过物理地址来访问内存</p>
<img lazyload src="/images/loading.svg" data-src="/2023/03/07/blog10/%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80.jpg" class title="虚拟地址">

<p>那么<strong>操作系统是如何管理虚拟地址和物理地址的关系的呢?</strong></p>
<p>主要是<strong>内存分段</strong>和<strong>内存分页</strong></p>
<h3 id="内存分段"><a href="#内存分段" class="headerlink" title="内存分段"></a>内存分段</h3><ol>
<li>程序是由若干个逻辑分段组成的，可由<strong>代码段</strong>，<strong>数据分段</strong>，<strong>堆</strong>，<strong>栈</strong>构成，<strong>因为不同段有不同的属性，所以就用分段的形式把这些段分离出来</strong></li>
<li>分段机制下，虚拟地址分为两部分:<strong>段选择子</strong>和<strong>段内偏移量</strong><details class="red" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>段选择子 </summary>
              <div class="content">
              <p>段选择子保存在<strong>寄存器</strong>中，段选择子最重要的是<strong>段号</strong>，可以用作<strong>段表</strong>的索引<br><strong>段表</strong>包含<strong>段基地址</strong>，<strong>段界限</strong>，<strong>特权级</strong></p>
              </div>
            </details>
<details class="red" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>段内偏移量 </summary>
              <div class="content">
              <p>段内偏移量位于0和段表中的<strong>段界限</strong>之间，如果段内偏移量合法，那么<strong>物理内存地址&#x3D;段基地址+段内偏移量</strong></p>
              </div>
            </details>
<img lazyload src="/images/loading.svg" data-src="/2023/03/07/blog10/%E6%AE%B5.jpg" class title="段"></li>
</ol>
<p>我们知道<strong>内存分段</strong>会将*<strong>虚拟地址</strong>分为4个段，每个段在段表中有一个项，在这一项找到段的基地址，再加上偏移量，于是就能找到物理内存中的地址</p>
<img lazyload src="/images/loading.svg" data-src="/2023/03/07/blog10/%E6%AE%B51.jpg" class title="段1">

<p>虽然分段的方法很好，但是它也是有一些问题的，其中之一就是<strong>内存碎片</strong></p>
<h4 id="内存碎片"><a href="#内存碎片" class="headerlink" title="内存碎片"></a>内存碎片</h4><p>首先我们先来考虑这样一个情况:</p>
<ol>
<li>有一个大小为900MB的物理内存，其中执行了3个进程，分别为<ol>
<li>进程1，占据了400的物理内存</li>
<li>进程2，占据了200的物理内存</li>
<li>进程3，占据了100的物理内存<br> 此时空余的物理内存大小为:900-400-200-100&#x3D;200MB</li>
</ol>
</li>
<li>此时我们结束掉大小为200的物理内存，那么我们剩余的物理内存大小就为400MB</li>
<li>当我们想要运行大小为300MB的一个进程4，此时是没办法运行的，这是为什么呢？<img lazyload src="/images/loading.svg" data-src="/2023/03/07/blog10/%E5%86%85%E5%AD%98%E7%A2%8E%E7%89%87.jpg" class title="内存碎片">
<details class="green" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>内存碎片 </summary>
              <div class="content">
              <p>内存碎片也分为两种</p><ol><li>外部内存碎片:产生了多个不连续的小物理内存，导致新的程序无法被载入，就例如上面那张图所示</li><li>内部内存碎片:程序所有的内存都被装载到了物理内存，<strong>但这个程序很大一部分内存是不经常使用的，这样会导致内存的浪费</strong></li></ol>
              </div>
            </details></li>
</ol>
<h4 id="如何解决外部内存碎片问题"><a href="#如何解决外部内存碎片问题" class="headerlink" title="如何解决外部内存碎片问题?"></a>如何解决外部内存碎片问题?</h4><p>我们可以利用<strong>内存交换</strong>的方法来解决外部内存碎片的问题，如何做到的呢?</p>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>内存交换 </summary>
              <div class="content">
              <p>将一个程序写到硬盘上，然后再从硬盘上读回到内存中，只不过读回来的时候，<strong>不能装载回原来的位置，而是紧接着已被占用的内存</strong></p><p><code>这个内存交换空间，在Linux系统中是Swap空间，这块空间是从硬盘划分出来的，用于内存与硬盘的空间交换</code></p>
              </div>
            </details>
<p>但是因为对于多进程的系统而言，内存碎片是很容易产生的，又因为硬盘的访问速度比内存慢太多了，每一次内存交换，都要把一大段连续的内存数据写到磁盘中，<strong>所以，如果内存交换的时候，交换的是一个占内存空间很大的程序，这样整个机器都会显得卡顿</strong></p>
<p>为了解决内存交换效率低下的问题，科学家们有研究出了一个新的方法:<strong>内存分页</strong></p>
<h3 id="内存分页"><a href="#内存分页" class="headerlink" title="内存分页"></a>内存分页</h3><ol>
<li>为了解决内存碎片的问题，另外，当需要进行内存交换时，让需要交换写入或者从磁盘中装载的数据更少一点，就出现了<strong>内存分页</strong>技术</li>
<li><strong>内存分页是把整个虚拟内存空间和物理内存空间切成一段段固定尺寸的大小</strong>。这样一个连续并且<strong>尺寸固定</strong>的内存空间，我们称之为<strong>页(page)</strong>,在Linux下，每一页的大小也<strong>4KB</strong></li>
<li>虚拟地址通过<strong>页表</strong>来映射物理地址<img lazyload src="/images/loading.svg" data-src="/2023/03/07/blog10/%E5%88%86%E9%A1%B5.jpg" class title="分页"></li>
<li>页表实际上存储在 CPU 的**内存管理单元(MMU)**中，于是CPU就可以直接通过MMU,找出要实际要访问的物理内存地址</li>
<li>当进程访问的虚拟地址在页表中查不到时,系统会产生一个<strong>缺页异常</strong>，进入系统内核空间分配物理内存、更新进程页表，最后再返回用户空间，恢复进程的运行</li>
</ol>
<h4 id="内存分页如何解决内存碎片、内存交换效率低的问题"><a href="#内存分页如何解决内存碎片、内存交换效率低的问题" class="headerlink" title="内存分页如何解决内存碎片、内存交换效率低的问题?"></a>内存分页如何解决内存碎片、内存交换效率低的问题?</h4><details class="red" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>不会产生内存碎片的原因 </summary>
              <div class="content">
              <p>由于<strong>无论是虚拟内存空间还是物理内存空间</strong>都是预先划分好的，也就是说不会像分段那样会产生间隙较小的内存，而采用了分页，那么<strong>释放的内存都是以页为单位释放的，也就不会产生无法给进程使用的小内存</strong></p>
              </div>
            </details>

<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>解决内存交换的效率低下问题的原因 </summary>
              <div class="content">
              <p>如果内存不够，操作系统会把其他<strong>正在运行的进程中[最近未经使用(LRU算法)]的内存页面给释放掉</strong>，称为<strong>换出(暂时写在硬盘上)</strong><br>一旦需要的时候，再加载进物理内存，称之为<strong>换入</strong><br>所以，一次性写入磁盘的也只有少数的一页或者几页，不会花费太多时间，<strong>内存交换的效率就比较高</strong></p>
              </div>
            </details>
<img lazyload src="/images/loading.svg" data-src="/2023/03/07/blog10/%E5%88%86%E9%A1%B51.jpg" class title="分页1">

<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>分页技术的好处之一 </summary>
              <div class="content">
              <p>分页技术使得程序在加载的时候，不需要将所有程序都加载到物理内存中。可以在进行虚拟内和物理内存的页之间的映射之后，并不把全部页都加载到物理内存，<strong>而是只有在程序运行时，需要用到对应虚拟内存页里面的指令和数据时，再将该页加载到物理内存中</strong></p>
              </div>
            </details>

<h4 id="虚拟地址如何映射到物理地址"><a href="#虚拟地址如何映射到物理地址" class="headerlink" title="虚拟地址如何映射到物理地址?"></a>虚拟地址如何映射到物理地址?</h4><p><code>虚拟地址=页号+页内偏移量</code><br>页号:页表的索引(页表包含物理页每页所在的物理内存的基地址)<br>页内偏移量:数据在物理页中的位置</p>
<img lazyload src="/images/loading.svg" data-src="/2023/03/07/blog10/%E9%A1%B5%E8%A1%A8.jpg" class title="页表">

<p>世界上没有完美的人，无论什么事都有两面性，就像我单身的话，我就只有偶尔会烦恼没有女朋友，但如果我有女朋友，我就会有很多烦恼，比如要送什么礼物啊，要去哪里约会啊，要如何当好一个合格的男朋友啊什么什么的，所以我选择<strong>单身!</strong>,并不是鼠鼠找不到奥，只是鼠鼠不想谈(哭)</p>
<p>所以内存分页也会出现一定的问题的</p>
<h4 id="内存分页出现的问题"><a href="#内存分页出现的问题" class="headerlink" title="内存分页出现的问题"></a>内存分页出现的问题</h4><p>因为一个进程对应一个页表(每个页在Linux下为4KB)，而在一个系统中可以同时运行非常多的进程，这样页表会非常庞大</p>
<details class="red" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>举个栗子 </summary>
              <div class="content">
              <p>一个进程的虚拟空间在32位操作系统中位4GB，而每一页在Linux下为4KB，因为一张页表需要包含所有虚拟空间的地址，所以一张页表大概需要100万个页(4GB&#x2F;4KB)，而每个页的页表项需要<strong>4个字节</strong>，所以整个4GB空间的映射需要<strong>4×100万&#x3D;4MB</strong>的内存来存储页表</p><p>虽然单个进程来看好像4MB不是很多，但是当有100个进程呢?1000个进程呢?此时光是页表占用的空间的很大了，这还只是在32位操作系统下，在64位操作系统下我都不敢相信欸!</p>
              </div>
            </details>

<h4 id="如何解决内存分页出现的问题"><a href="#如何解决内存分页出现的问题" class="headerlink" title="如何解决内存分页出现的问题"></a>如何解决内存分页出现的问题</h4><p>聪明的科学家相处了<strong>多级页表</strong>的方法来解决这个问题，那么什么是多级页表呢?<br>我们很容易地可以从字面意思知道，<strong>多级页表</strong>就是将页表分级，分为一级，两级等等，那么如何分呢?<br>如下(在32位操作系统下):</p>
<ol>
<li>我们把有着100多万个页表项的页表进行二次分页</li>
<li>将一级页表分为<strong>1024</strong>个<strong>二级页表</strong>，每个<strong>二级页表</strong>包含<strong>1024</strong>个页表项，如下图所示<img lazyload src="/images/loading.svg" data-src="/2023/03/07/blog10/%E4%BA%8C%E7%BA%A7%E9%A1%B5%E8%A1%A8.jpg" class title="二级页表">
此时一个进程需要映射的所有页表大小加起来为**4字节×1024(一级页表的大小)+1024×(一张二级页表的大小 1024×4字节)&#x3D;4KB+4MB</li>
</ol>
<p>此时很多人会疑惑，这样不是比单级页表所需要的内存空间更大了嘛？但实际上真的是这样吗?不对哦<br>在这里我们需要知道:</p>
<ol>
<li>大多数进程是没办法使用到4GB的虚拟内存的，也就是说我们不需要把4GB的虚拟地址都有一个映射到的物理地址，只有进程占用的虚拟内存才需要映射</li>
<li>这也就意味很多页是用不到的，根本没有分配，对于已分配的页表项，如果存在最近一定时间未访问的页表，在物理内存紧张的情况下，操作系统会将页面换出到硬盘，也就是说不会占用物理内存</li>
<li>如果只是单级页表的话，因为<strong>页表的职责就是将虚拟地址转化为物理地址</strong>，也就是说，我们不能有<code>虚拟地址没法在叶表上找到对应的物理地址</code>这种情况出现，所以必须包含所有的虚拟空间地址</li>
<li>如果是二级表的话，一级表其实和二级表是类似的，也包含了所有的虚拟地址，只不过一级表中每一页包含了很多个虚拟地址，那样就可以只用<strong>1024</strong>个页表项来包含整个虚拟地址了</li>
<li>当一个进程没有用到某个一级页表包含的虚拟地址时，就不需要去创建二级页表了，只有当需要的时候才创建</li>
</ol>
<p>做个简单的计算，假设只有<strong>20%<strong>的一级页表项被用到了，那么页表占用的内存空间就只有</strong>4KB(一级页表)+ 20%×4MB(二级页表)&#x3D; 0.804MB</strong>，这远远小于单级页表的4MB大小</p>
<p>当然了，有二级页表，自然也可以有3级、4级等等，在当今的64位操作系统下，2级页表也不够看了，所以如今大多是4级页表，分别是:</p>
<ol>
<li>全局页目录项 PGD(Page Global Directory)</li>
<li>上层页目录项 PUD(Page Upper Directory)</li>
<li>中间页目录项 PMD(Page Middle Directory)</li>
<li>页表项 PTE(Page Table Entry)<img lazyload src="/images/loading.svg" data-src="/2023/03/07/blog10/%E5%9B%9B%E7%BA%A7%E9%A1%B5%E8%A1%A8.jpg" class title="四级页表"></li>
</ol>
<p>此时又出现问题啦，没错，我们总是在不断地寻找问题并解决问题，我们一直在这个道路上前进</p>
<p><code>多级页表虽然解决了空间上的问题，但是虚拟地址到物理地址的转换就多了几道转换的工序，这显然就降低了这俩地址转换的速度，也就是带来了时间上的开销</code></p>
<p>我们应该知道:<br>程序是有局部性的，即在一段时间内，整个程序的执行仅限于程序中的某一部分。相应地，执行所访问的存储空间也局限于某个内存区域</p>
<p>我们就可以利用这一特性，把最常访问的几个页表项存储到访问速度更快的硬件，于是计算机科学家们，就在 CPU 芯片中，加入了一个专门存放程序最常访问的页表项的<strong>Cache</strong>,这个 Cache 就是 TLB(Translation Lookaside Buffer)，通常称为页表缓存、转址旁路缓存、快表等</p>
<h4 id="TLB"><a href="#TLB" class="headerlink" title="TLB"></a>TLB</h4><img lazyload src="/images/loading.svg" data-src="/2023/03/07/blog10/TLB.jpg" class title="TLB">
<ol>
<li>在 CPU 芯片里面，封装了内存管理单元（Memory Management Unit）芯片，它用来完成地址转换和 TLB 的访问与交互</li>
<li>有了 TLB 后，那么 CPU 在寻址时，会先查 TLB，如果没找到，才会继续查常规的页表</li>
<li>TLB 的命中率其实是很高的，因为程序最常访问的页就那么几个</li>
</ol>
<h3 id="段页式内存管理"><a href="#段页式内存管理" class="headerlink" title="段页式内存管理"></a>段页式内存管理</h3><p>内存分段和内存分页并不是对立的，它们是可以组合起来在同一个系统中使用的，那么组合起来后，通常称为<strong>段页式内存管理</strong></p>
<img lazyload src="/images/loading.svg" data-src="/2023/03/07/blog10/%E6%AE%B5%E9%A1%B5%E5%BC%8F.jpg" class title="段页式">
<h4 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h4><ol>
<li>先将程序分为多个具有逻辑意义的段(<strong>代码段</strong>，<strong>数据段</strong>，<strong>栈</strong>，<strong>堆</strong>等)，也就是<strong>分段机制</strong></li>
<li>再把每个段划分位多个<strong>页</strong>，这样，虚拟地址结构就由<strong>段号，段内页号和页内偏移量</strong>三部分组成</li>
</ol>
<h4 id="段页式地址变换到物理地址"><a href="#段页式地址变换到物理地址" class="headerlink" title="段页式地址变换到物理地址"></a>段页式地址变换到物理地址</h4><p>想要将段内式地址变换得到物理地址需要经过三次内存访问:</p>
<ol>
<li>第一次，通过段号访问段表，获取页表的起始地址</li>
<li>第二次，通过第一次访问到的页表起始地址访问页表，通过<strong>段内页号</strong>找到页表中对应的页号，获取对应的物理地址</li>
<li>第三次，通过第二次得到的物理地址加上页内偏移量，获得真正的<strong>物理地址</strong><details class="green" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>优势 </summary>
              <div class="content">
              <p>提高了内存的利用率</p>
              </div>
            </details>
<details class="green" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>劣势 </summary>
              <div class="content">
              <p>增加了硬件成本和系统开销</p>
              </div>
            </details></li>
</ol>
<h3 id="Linux的内存管理"><a href="#Linux的内存管理" class="headerlink" title="Linux的内存管理"></a>Linux的内存管理</h3><p>先来看看Intel处理器的发展历史</p>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Intel处理器的发展历史 </summary>
              <div class="content">
              <ol><li>早期 Intel 的处理器从<strong>80286</strong>开始使用的是<strong>段式内存管理</strong>。但是很快发现，光有段式内存管理而没有页式内存管理是不够的，这会使它的 X86 系列会失去市场的竞争力。因此，在不久以后的 80386 中就实现了对<strong>页式内存管理</strong>。也就是说，80386 除了完成并完善从 80286 开始的段式内存管理的同时还实现了页式内存管理</li><li>但是这个<strong>80386</strong>的页式内存管理设计时，没有绕开段式内存管理，而是建立在段式内存管理的基础上，这就意味着，页式内存管理的作用是在由段式内存管理所映射而成的的地址上再加上一层地址映射</li><li>由于此时段式内存管理映射而成的地址不再是“物理地址”了，Intel 就称之为“线性地址”(也称虚拟地址)。于是，段式内存管理先将<strong>逻辑地址</strong>映射成<strong>线性地址</strong>，然后再由<strong>页式内存管理</strong>将<strong>线性地址</strong>映射成<strong>物理地址</strong><img lazyload src="/images/loading.svg" data-src="/2023/03/07/blog10/Intel.jpg" class title="Intel">逻辑地址:   程序所使用的地址，通常是没被段式内存管理映射的地址线性地址:   通过段式内存管理映射的地址，称为线性地址，也叫虚拟地址`逻辑地址是「段式内存管理」转换前的地址，线性地址则是「页式内存管理」转换前的地址`</li></ol>
              </div>
            </details>
<p>知道这些后，再来看看Linux的内存管理</p>
<ol>
<li><p>Linux 内存主要采用的是页式内存管理，但同时也不可避免地涉及了段机制</p>
</li>
<li><p>这主要是上面 Intel 处理器发展历史导致的，因为 Intel X86 CPU 一律对程序中使用的地址先进行段式映射，然后才能进行页式映射。既然 CPU 的硬件结构是这样，Linux 内核也只好服从 Intel 的选择</p>
</li>
<li><p>但是事实上，Linux 内核所采取的办法是使段式映射的过程实际上不起什么作用。也就是说，“上有政策，下有对策”，若惹不起就躲着走</p>
</li>
<li><p>Linux 系统中的每个段都是从<strong>0 地址</strong>开始的整个 4GB 虚拟空间(32 位环境下)，也就是<strong>所有的段的起始地址都是一样的</strong>。</p>
</li>
<li><p>这意味着，Linux 系统中的代码，包括操作系统本身的代码和应用程序代码，所面对的地址空间都是线性地址空间(虚拟地址)，这种做法相当于屏蔽了处理器中的逻辑地址概念，段只被用于访问控制和内存保护。</p>
</li>
</ol>
<h2 id="关于内存管理的一些问题"><a href="#关于内存管理的一些问题" class="headerlink" title="关于内存管理的一些问题"></a>关于内存管理的一些问题</h2><h3 id="在4G物理内存的机器上，申请8G的内存会怎么样？"><a href="#在4G物理内存的机器上，申请8G的内存会怎么样？" class="headerlink" title="在4G物理内存的机器上，申请8G的内存会怎么样？"></a>在4G物理内存的机器上，申请8G的内存会怎么样？</h3><p>在回答这个问题之前，让我们先了解一下用户如何申请内存，我们在写代码的时候，如果希望开辟一个新的空间，我们可以使用**malloc()&#x2F;new()**函数来申请内存空间，那么底层是怎么实现的呢?</p>
<h4 id="Linux下分配虚拟内存-申请内存-的两种方法"><a href="#Linux下分配虚拟内存-申请内存-的两种方法" class="headerlink" title="Linux下分配虚拟内存(申请内存)的两种方法"></a>Linux下分配虚拟内存(申请内存)的两种方法</h4><details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>brk </summary>
              <div class="content">
              <p>申请小于128k的内存时，使用brk分配内存，将<strong>数据段.data</strong>的最高地址指针_edata向高地址移动，即增加<strong>堆</strong>的有效区域来申请新的内存空间</p>
              </div>
            </details>

<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>mmap </summary>
              <div class="content">
              <p>申请大于128k的内存时，使用mmap分配内存，mmap是在进程的文件映射区找一块空闲存储空间，128K限制可由M_MMAP_THRESHOLD选项进行修改</p>
              </div>
            </details>

<p>注意:<br><code>当应用程序使用**malloc**进行申请空间后，实际上申请的是**虚拟空间**，只有当我们使用这块虚拟空间的时候，CPU就会去访问这块虚拟内存，根据页表进行映射，但由于是第一次，会发现页表上并没有该虚拟地址对应的物理地址，此时CPU就会产生一个缺页中断，进程会从用户态变成内核态，并将缺页中断交给Page Fault Handler(缺页中断函数)处理</code><br>缺页中断处理函数会看是否有空闲的物理内存:</p>
<ol>
<li>如果有，就直接分配物理内存，并建立虚拟内存与物理内存之间的映射关系</li>
<li>如果没有空闲的物理内存，那么内核就会开始进行回收内存的工作，如果回收内存工作结束后，空闲的物理内存仍然无法满足此次物理内存的申请，那么内核就会放最后的大招了触发**OOM(Out of Memory)**机制</li>
</ol>
<h4 id="在不同的环境下对问题的解答"><a href="#在不同的环境下对问题的解答" class="headerlink" title="在不同的环境下对问题的解答"></a>在不同的环境下对问题的解答</h4><details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>在32位操作系统下并且物理内存只有4GB的环境下 </summary>
              <div class="content">
              <p>如果在该环境下进行申请，是会<strong>失败</strong>的<br>因为我们知道32位操作系统下，进程的虚拟内存在用户态最大只有<strong>3GB</strong>，所以是没有办法申请8GB的虚拟内存的，也就是无法申请内存</p>
              </div>
            </details>

<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>在64位操作系统下并且物理内存只有4GB的环境下 </summary>
              <div class="content">
              <p>因为如果只是申请虚拟内存的话，是可以成功的，因为64G的操作系统环境下，用户空间高达128T<br>但是也有可能在Linux下是会失败的，那是因为Linux有一个参数需要我们注意，那就是<strong>overcommit_memory</strong></p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/sys/vm/overcommit_memory </span><br><span class="line">//查看overcommit_memory参数</span><br></pre></td></tr></table></figure></div><p>overcommit_memory参数的值:</p><ol><li>如果值为<strong>0(默认值)<strong>，代表:<strong>Heuristic overcommit handling</strong>，它允许overcommit，但</strong>过于明目张胆的</strong> overcommit 会被拒绝，比如<strong>malloc一次性申请的内存大小就超过了系统总内存</strong>。Heuristic的意思是“试探式的”，内核利用某种算法猜测你的内存申请是否合理，大概可以理解为单次申请不能超过free memory + free swap + pagecache的大小 + SLAB中可回收的部分 ，超过了就会拒绝overcommit</li><li>如果值为 1，代表:Always overcommit. 允许overcommit，对内存申请来者不拒</li><li>如果值为 2，代表：Don’t overcommit. 禁止overcommit</li></ol>
              </div>
            </details>

<h4 id="问题衍生"><a href="#问题衍生" class="headerlink" title="问题衍生"></a>问题衍生</h4><p>假设我们在64位操作系统，并且overcommit_memory的值为1的时候，申请128T的虚拟内存就一定可以成功嘛?</p>
<p>答案:不一定，我们还需要根据物理内存的大小来判断。</p>
<details class="red" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>当我们的物理内存只有2G </summary>
              <div class="content">
              <p>实验后发现，当我们还没有申请到128T虚拟内存的时候就被杀死了，而且错误信息为<strong>killed</strong>,也就是触发<strong>OOM</strong>了</p><details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>什么是OOM? </summary>              <div class="content">              <p>内存溢出(Out Of Memory，简称OOM)是指应用系统中存在无法回收的内存或使用的内存过多，最终使得程序运行要用到的内存大于能提供的最大内存。此时程序就运行不了，系统会提示内存溢出</p>              </div>            </details><p>这是因为即使我们只是申请虚拟内存，但仍旧使用到了物理内存(比如内核保存虚拟内存的数据结构，也是占用物理内存的),所以如果<strong>物理内存</strong>太小的话，大概率是会出发OOM机制的</p>
              </div>
            </details>

<p>那么，2G的物理内存就没有办法申请128T的虚拟内存了吗?<br>其实这也是要根据情况来说的，是什么情况呢?那就是要看我们的操作系统有没有开启<strong>Swap机制</strong><br>使用<strong>swapfile</strong>的方式开启了<strong>1GB</strong>的<strong>swap空间</strong>之后再做实验，虽然最后出现了<strong>Cannot allocate memory</strong>，但计算下来我们发现其实以及申请成功了，实际上我们是不可能申请完整个 128T 的用户空间的，因为程序运行本身也需要申请虚拟空间</p>
<h4 id="Swap机制的作用"><a href="#Swap机制的作用" class="headerlink" title="Swap机制的作用"></a>Swap机制的作用</h4><p>前面我们说过了，在<strong>分段机制下</strong>，如果想要解决内存碎片的问题，最开始的解决方法就是<strong>swap</strong><br><code>当系统的物理内存不够用的时候，就需要将物理内存中的一部分空间释放出来，以供当前运行的程序使用。那些被释放的空间可能来自一些很长时间没有什么操作的程序，这些被释放的空间会被临时保存到磁盘，等到那些程序要运行时，再从磁盘中恢复保存的数据到内存中</code><br><code>另外，当内存使用存在压力的时候，会开始触发内存回收行为，会把这些不常访问的内存先写到磁盘中，然后释放这些内存，给其他更需要的进程使用。再次访问这些内存时，重新从磁盘读入内存就可以了</code></p>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>swap的两个过程 </summary>
              <div class="content">
              <p>换入:是在进程再次访问这些内存的时候，把它们从磁盘读到内存中来<br>换出:是把进程暂时不用的内存数据存储到磁盘中，并释放这些数据占用的内存<br><img lazyload src="/images/loading.svg" data-src="/2023/03/07/blog10/swap.jpg" class title="swap"></p>
              </div>
            </details>

<details class="green" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>swap的优势 </summary>
              <div class="content">
              <p>应用程序实际可以使用的内存空间将远远超过系统的物理内存。由于硬盘空间的价格远比内存要低，因此这种方式无疑是经济实惠的</p>
              </div>
            </details>
<details class="green" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>swap的劣势 </summary>
              <div class="content">
              <p>频繁地读写硬盘，会显著降低操作系统的运行速率</p>
              </div>
            </details>

<details class="red" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>swap机制触发的两种场景 </summary>
              <div class="content">
              <ol><li>内存不足:之前一直说的，物理内存不足的时候，会将(最久未经使用)的物理内存换出</li><li>内存闲置:<br>应用程序在启动阶段使用的大量内存在启动后往往都不会使用，通过后台运行的守护进程(kSwapd)，我们可以将这部分只使用一次的内存交换到磁盘上为其他内存的申请预留空间。kSwapd 是 Linux 负责页面置换(Page replacement)的守护进程，它也是负责交换闲置内存的主要进程，它会在回收内存页中的空闲内存保证系统中的其他进程可以尽快获得申请的内存。kSwapd 是后台进程，所以回收内存的过程是异步的，不会阻塞当前申请内存的进程</li></ol>
              </div>
            </details>
<h4 id="Swap机制换出换入的是什么类型的内存"><a href="#Swap机制换出换入的是什么类型的内存" class="headerlink" title="Swap机制换出换入的是什么类型的内存"></a>Swap机制换出换入的是什么类型的内存</h4><p>内核缓存的文件数据，因为都有对应的磁盘文件，所以在回收文件数据的时候， 直接写回到对应的文件就可以了，这部分内存被称为<strong>文件页</strong></p>
<p>但是像进程的堆、栈数据等，它们是没有实际载体，这部分内存被称为<strong>匿名页</strong>。而且这部分内存很可能还要再次被访问，所以不能直接释放内存，于是就需要有一个能保存匿名页的磁盘载体，这个载体就是 Swap 分区</p>
<p>匿名页回收的方式是通过 Linux 的 Swap 机制，Swap 会把不常访问的内存先写到磁盘中，然后释放这些内存，给其他更需要的进程使用。再次访问这些内存时，重新从磁盘读入内存就可以了</p>
<h4 id="有了Swap机制后就可以无上限地申请虚拟内存空间了吗"><a href="#有了Swap机制后就可以无上限地申请虚拟内存空间了吗" class="headerlink" title="有了Swap机制后就可以无上限地申请虚拟内存空间了吗?"></a>有了Swap机制后就可以无上限地申请虚拟内存空间了吗?</h4><p>岂可休，这肯定是不允许的啊!这样子的话…会坏掉的…，哪里有可能一直换下去啊，到了一定程度就会出发OOM机制了，啊当然我自己是没试过的</p>

            </div>

            
                <div class="post-copyright-info">
                    <div class="article-copyright-info-container">
    <ul>
        <li><strong>标题:</strong> 操作系统中的内存管理</li>
        <li><strong>作者:</strong> 这题超纲了</li>
        <li><strong>创建于:</strong> 2023-03-07 13:39:46</li>
        
            <li>
                <strong>更新于:</strong> 2023-06-23 14:39:23
            </li>
        
        <li>
            <strong>链接:</strong> https://qx-gg.github.io/2023/03/07/blog10/
        </li>
        <li>
            <strong>版权声明:</strong> 本文章采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a> 进行许可。
        </li>
    </ul>
</div>

                </div>
            

            
                <ul class="post-tags-box">
                    
                        <li class="tag-item">
                            <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">#操作系统</a>&nbsp;
                        </li>
                    
                </ul>
            

            <div class="recommended-article">
  <div class="recommended-article-header">
    <i aria-hidden="true"></i><span>推荐阅读</span>
  </div>
  <div class="recommended-article-group"><a class="recommended-article-item" href="/2023/03/03/blog9/" title="CPU是如何执行程序的呢？CPU又是如何调度任务的呢？一些关于CPU的知识总结" rel="bookmark">
  <img src="https://Qx-GG.github.io/images/水墨/水墨10.jpg" alt="CPU是如何执行程序的呢？CPU又是如何调度任务的呢？一些关于CPU的知识总结">
  <span class="title">CPU是如何执行程序的呢？CPU又是如何调度任务的呢？一些关于CPU的知识总结</span>
</a><a class="recommended-article-item" href="/2023/02/24/blog5/" title="浙江宇视科技一面" rel="bookmark">
  <img src="https://Qx-GG.github.io/images/水墨/水墨6.jpg" alt="浙江宇视科技一面">
  <span class="title">浙江宇视科技一面</span>
</a><a class="recommended-article-item" href="/2023/02/25/blog6/" title="进程间通信的各种方法以及优缺点" rel="bookmark">
  <img src="https://Qx-GG.github.io/images/水墨/水墨7.jpg" alt="进程间通信的各种方法以及优缺点">
  <span class="title">进程间通信的各种方法以及优缺点</span>
</a></div>
</div>

            
                <div class="article-nav">
                    
                        <div class="article-prev">
                            <a class="prev"
                            rel="prev"
                            href="/2023/03/10/blog11/"
                            >
                                <span class="left arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-left"></i>
                                </span>
                                <span class="title flex-center">
                                    <span class="post-nav-title-item">C++中的一些设计模式</span>
                                    <span class="post-nav-item">上一篇</span>
                                </span>
                            </a>
                        </div>
                    
                    
                        <div class="article-next">
                            <a class="next"
                            rel="next"
                            href="/2023/03/05/day2/"
                            >
                                <span class="title flex-center">
                                    <span class="post-nav-title-item">随笔·广州·心心念念的&#34;太古仓&#34;之行</span>
                                    <span class="post-nav-item">下一篇</span>
                                </span>
                                <span class="right arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-right"></i>
                                </span>
                            </a>
                        </div>
                    
                </div>
            


            
                <div class="comment-container">
                    <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fa-solid fa-comments"></i>&nbsp;评论
    </div>
    

        
            
 
    <div id="waline"></div>
    <script type="module"  data-pjax>
        import { init } from 'https://evan.beee.top/js/waline.mjs';

        function loadWaline() {
            init({
                el: '#waline',
                serverURL: 'https://waline-qin.6eek.net',
                lang: 'zh-CN',
                dark: 'body[class~="dark-mode"]',
                requiredMeta: ['nick','mail'], // cannot customize by theme config, change it yourself
            });
        }

        if ('true') {
            const loadWalineTimeout = setTimeout(() => {
                loadWaline();
                clearTimeout(loadWalineTimeout);
            }, 1000);
        } else {
            window.addEventListener('DOMContentLoaded', loadWaline);
        }
        
    </script>



        
    
</div>

                </div>
            
        </div>

        
            <div class="toc-content-container">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">此页目录</div>
        <div class="page-title">操作系统中的内存管理</div>
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="nav-text">内存管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98"><span class="nav-text">虚拟内存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E5%88%86%E6%AE%B5"><span class="nav-text">内存分段</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E7%A2%8E%E7%89%87"><span class="nav-text">内存碎片</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%A4%96%E9%83%A8%E5%86%85%E5%AD%98%E7%A2%8E%E7%89%87%E9%97%AE%E9%A2%98"><span class="nav-text">如何解决外部内存碎片问题?</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E5%88%86%E9%A1%B5"><span class="nav-text">内存分页</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E5%88%86%E9%A1%B5%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%86%85%E5%AD%98%E7%A2%8E%E7%89%87%E3%80%81%E5%86%85%E5%AD%98%E4%BA%A4%E6%8D%A2%E6%95%88%E7%8E%87%E4%BD%8E%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-text">内存分页如何解决内存碎片、内存交换效率低的问题?</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E5%A6%82%E4%BD%95%E6%98%A0%E5%B0%84%E5%88%B0%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80"><span class="nav-text">虚拟地址如何映射到物理地址?</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E5%88%86%E9%A1%B5%E5%87%BA%E7%8E%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-text">内存分页出现的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%86%85%E5%AD%98%E5%88%86%E9%A1%B5%E5%87%BA%E7%8E%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-text">如何解决内存分页出现的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TLB"><span class="nav-text">TLB</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AE%B5%E9%A1%B5%E5%BC%8F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="nav-text">段页式内存管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F"><span class="nav-text">实现方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AE%B5%E9%A1%B5%E5%BC%8F%E5%9C%B0%E5%9D%80%E5%8F%98%E6%8D%A2%E5%88%B0%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80"><span class="nav-text">段页式地址变换到物理地址</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Linux%E7%9A%84%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="nav-text">Linux的内存管理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98"><span class="nav-text">关于内存管理的一些问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A84G%E7%89%A9%E7%90%86%E5%86%85%E5%AD%98%E7%9A%84%E6%9C%BA%E5%99%A8%E4%B8%8A%EF%BC%8C%E7%94%B3%E8%AF%B78G%E7%9A%84%E5%86%85%E5%AD%98%E4%BC%9A%E6%80%8E%E4%B9%88%E6%A0%B7%EF%BC%9F"><span class="nav-text">在4G物理内存的机器上，申请8G的内存会怎么样？</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Linux%E4%B8%8B%E5%88%86%E9%85%8D%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98-%E7%94%B3%E8%AF%B7%E5%86%85%E5%AD%98-%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%B3%95"><span class="nav-text">Linux下分配虚拟内存(申请内存)的两种方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%9A%84%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%AF%B9%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E7%AD%94"><span class="nav-text">在不同的环境下对问题的解答</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E8%A1%8D%E7%94%9F"><span class="nav-text">问题衍生</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Swap%E6%9C%BA%E5%88%B6%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="nav-text">Swap机制的作用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Swap%E6%9C%BA%E5%88%B6%E6%8D%A2%E5%87%BA%E6%8D%A2%E5%85%A5%E7%9A%84%E6%98%AF%E4%BB%80%E4%B9%88%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%86%85%E5%AD%98"><span class="nav-text">Swap机制换出换入的是什么类型的内存</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%89%E4%BA%86Swap%E6%9C%BA%E5%88%B6%E5%90%8E%E5%B0%B1%E5%8F%AF%E4%BB%A5%E6%97%A0%E4%B8%8A%E9%99%90%E5%9C%B0%E7%94%B3%E8%AF%B7%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%A9%BA%E9%97%B4%E4%BA%86%E5%90%97"><span class="nav-text">有了Swap机制后就可以无上限地申请虚拟内存空间了吗?</span></a></li></ol></li></ol></li></ol>

    </div>
</div>
            </div>
        
    </div>
</div>


                

            </div>
            
            

        </div>

        <div class="main-content-footer">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info">
            &copy;
            
              <span>2023</span>
              -
            
            2023&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">这题超纲了</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv" class="busuanzi_container_site_uv">
                        访问人数&nbsp;<span id="busuanzi_value_site_uv" class="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="busuanzi_container_site_pv">
                        总访问量&nbsp;<span id="busuanzi_value_site_pv" class="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            <span class="powered-by-container">由 <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" href="https://hexo.io">Hexo</a> 驱动</span>
                <br>
            <span class="theme-version-container">主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.1.5</a>
        </div>
        
        
        
            <div id="start_div" style="display:none">
                2023/2/23 15:15:11
            </div>
            <div>
                博客已运行 <span class="odometer" id="runtime_days" ></span> 天 <span class="odometer" id="runtime_hours"></span> 小时 <span class="odometer" id="runtime_minutes"></span> 分钟 <span class="odometer" id="runtime_seconds"></span> 秒
            </div>
        
        
            <div class="customize-info info-item">和我一起去充满橘子味的村庄叭</div>
        
        
            <script async data-pjax>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
            
                
        
                
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fa-regular fa-comments"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-expand-width flex-center">
            <i class="fa-regular fa-expand"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fa-solid fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fa-solid fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    


</main>



<script src="https://npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/js/utils.js"></script><script src="https://npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/js/main.js"></script><script src="https://npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/js/layouts/navbarShrink.js"></script><script src="https://npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/js/tools/scrollTopBottom.js"></script><script src="https://npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/js/tools/lightDarkSwitch.js"></script>


    <script src="https://npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/js/tools/localSearch.js"></script>



    <script src="https://npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/js/tools/codeBlock.js"></script>



    <script src="https://npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/js/layouts/lazyload.js"></script>



    <script src="https://npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/js/tools/runtime.js"></script>
    <script src="https://npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/js/libs/odometer.min.js"></script>
    <link rel="stylesheet" href="//npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/assets/odometer-theme-minimal.css">



  <script src="https://npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/js/libs/Typed.min.js"></script>
  <script src="https://npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/js/plugins/typed.js"></script>





    <script src="https://npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/js/libs/minimasonry.min.js"></script>
    <script src="https://npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/js/plugins/masonry.js"></script>


<div class="post-scripts pjax">
    
        <script src="https://npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/js/tools/tocToggle.js"></script><script src="https://npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/js/libs/anime.min.js"></script><script src="https://npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/js/layouts/toc.js"></script><script src="https://npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/js/plugins/tabs.js"></script>
    
</div>


    <script src="https://npm.elemecdn.com/hexo-theme-redefine@2.1.5/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax',
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            Global.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            Global.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            Global.refresh();
        });
    });
</script>




</body>
</html>
